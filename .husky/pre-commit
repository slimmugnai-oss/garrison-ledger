#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Garrison Ledger Pre-Commit Hook
# Runs security and quality checks before allowing commit

echo "ğŸ” Running pre-commit checks..."

# 1. Secret Scan (CRITICAL - blocks commits with secrets)
echo "  ğŸ”’ Scanning for exposed secrets..."
npm run secret-scan
if [ $? -ne 0 ]; then
  echo "âŒ SECRET SCAN FAILED: Exposed secrets detected!"
  echo "   Run 'npm run secret-scan -- --fix' to auto-mask secrets"
  echo "   Or manually remove/mask secrets before committing"
  exit 1
fi

# 2. TypeScript Check
echo "  ğŸ“˜ Checking TypeScript..."
npx tsc --noEmit
if [ $? -ne 0 ]; then
  echo "âš ï¸  TypeScript errors detected (not blocking)"
fi

# 3. Icon Registry Check
echo "  ğŸ¨ Validating icon usage..."
npm run check-icons
if [ $? -ne 0 ]; then
  echo "âš ï¸  Icon usage violations detected (not blocking)"
fi

echo "âœ… Pre-commit checks passed!"
exit 0

