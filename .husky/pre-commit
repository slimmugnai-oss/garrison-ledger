#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run secret scan
echo "🔒 Running secret scan..."
npm run secret-scan

# Run content linter on changed content files
CHANGED_CONTENT=$(git diff --cached --name-only --diff-filter=ACM | grep '^content/.*\.mdx$' || true)

if [ -n "$CHANGED_CONTENT" ]; then
  echo "📝 Content files changed, running linter..."
  npm run content:lint
  
  LINT_EXIT=$?
  if [ $LINT_EXIT -ne 0 ]; then
    echo "⚠️  Content linter found issues. Run 'npm run content:autofix' to fix automatically, or use --no-verify to skip."
    exit 1
  fi
fi

echo "✅ Pre-commit checks passed!"
